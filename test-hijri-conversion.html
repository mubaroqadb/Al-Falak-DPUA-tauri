<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test Konversi Hijri ke Masehi</title>
  <script src="https://unpkg.com/@tauri-apps/api@2.9.1/dist/tauri.umd.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      background: #f5f5f5;
    }
    h1 {
      color: #333;
      text-align: center;
      margin-bottom: 30px;
    }
    .test-container {
      background: white;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .test-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px;
      border-bottom: 1px solid #eee;
    }
    .test-row:last-child {
      border-bottom: none;
    }
    .test-info {
      flex: 1;
    }
    .test-name {
      font-weight: bold;
      color: #333;
      margin-bottom: 5px;
    }
    .test-dates {
      display: flex;
      gap: 20px;
      font-size: 14px;
    }
    .date-label {
      color: #666;
      font-size: 12px;
      margin-bottom: 3px;
    }
    .date-value {
      font-family: 'Courier New', monospace;
      font-size: 16px;
      color: #333;
    }
    .test-result {
      min-width: 100px;
      text-align: center;
      padding: 10px 20px;
      border-radius: 5px;
      font-weight: bold;
    }
    .pass {
      background: #d4edda;
      color: #155724;
    }
    .fail {
      background: #f8d7da;
      color: #721c24;
    }
    .error {
      background: #fee;
      color: #c53030;
    }
    .summary {
      background: #333;
      color: white;
      padding: 20px;
      border-radius: 8px;
      margin-top: 20px;
    }
    .summary-stats {
      display: flex;
      justify-content: space-around;
      font-size: 18px;
    }
    button {
      background: #007bff;
      color: white;
      border: none;
      padding: 15px 30px;
      border-radius: 5px;
      font-size: 16px;
      cursor: pointer;
      margin: 20px auto;
      display: block;
    }
    button:hover {
      background: #0056b3;
    }
    button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    .loading {
      text-align: center;
      padding: 20px;
      color: #666;
    }
  </style>
</head>
<body>
  <h1>üß™ Test Konversi Hijri ke Masehi</h1>

  <div id="loading" class="loading">
    <p>Memuat...</p>
  </div>

  <div id="results" style="display: none;">
    <div class="test-container">
      <div id="test-rows"></div>
    </div>

    <div class="summary">
      <div class="summary-stats">
        <div>Total: <span id="total">0</span></div>
        <div>‚úÖ Pass: <span id="passed">0</span></div>
        <div>‚ùå Fail: <span id="failed">0</span></div>
      </div>
    </div>
  </div>

  <button id="run-test" onclick="runTests()">üöÄ Jalankan Test</button>

  <script>
    const expectedResults = [
      { hijri: { year: 1447, month: 7, day: 1 }, gregorian: { year: 2026, month: 1, day: 20 }, name: "Sya'ban 1447 H" },
      { hijri: { year: 1447, month: 9, day: 1 }, gregorian: { year: 2026, month: 2, day: 19 }, name: "Ramadhan 1447 H" },
      { hijri: { year: 1447, month: 10, day: 1 }, gregorian: { year: 2026, month: 3, day: 21 }, name: "Syawal 1447 H" },
      { hijri: { year: 1447, month: 11, day: 1 }, gregorian: { year: 2026, month: 4, day: 19 }, name: "DzulQo'dah 1447 H" },
      { hijri: { year: 1447, month: 12, day: 1 }, gregorian: { year: 2026, month: 5, day: 18 }, name: "Dzulhijjah 1447 H" },
      { hijri: { year: 1448, month: 1, day: 1 }, gregorian: { year: 2026, month: 6, day: 17 }, name: "Muharram 1448 H" },
      { hijri: { year: 1448, month: 2, day: 1 }, gregorian: { year: 2026, month: 7, day: 16 }, name: "Safar 1448 H" },
      { hijri: { year: 1448, month: 3, day: 1 }, gregorian: { year: 2026, month: 8, day: 14 }, name: "Rabiul Awal 1448 H" },
      { hijri: { year: 1448, month: 4, day: 1 }, gregorian: { year: 2026, month: 9, day: 13 }, name: "Rabiul Akhir 1448 H" },
      { hijri: { year: 1448, month: 5, day: 1 }, gregorian: { year: 2026, month: 10, day: 12 }, name: "Jumadil Ula 1448 H" },
      { hijri: { year: 1448, month: 6, day: 1 }, gregorian: { year: 2026, month: 11, day: 11 }, name: "Jumadil Tsani 1448 H" },
      { hijri: { year: 1448, month: 7, day: 1 }, gregorian: { year: 2026, month: 12, day: 11 }, name: "Rajab 1448 H" },
      { hijri: { year: 1448, month: 8, day: 1 }, gregorian: { year: 2027, month: 1, day: 9 }, name: "Sya'ban 1448 H" }
    ];

    async function runTests() {
      const button = document.getElementById('run-test');
      const loading = document.getElementById('loading');
      const results = document.getElementById('results');

      button.disabled = true;
      loading.style.display = 'block';
      results.style.display = 'none';

      let passed = 0;
      let failed = 0;
      let html = '';

      for (const test of expectedResults) {
        try {
          const result = await window.__TAURI__.core.invoke('hijri_to_gregorian_command', {
            year: test.hijri.year,
            month: test.hijri.month,
            day: test.hijri.day
          });

          const yearMatch = result.year === test.gregorian.year;
          const monthMatch = result.month === test.gregorian.month;
          const dayMatch = result.day === test.gregorian.day;
          const isPass = yearMatch && monthMatch && dayMatch;

          if (isPass) {
            passed++;
          } else {
            failed++;
          }

          html += `
            <div class="test-row">
              <div class="test-info">
                <div class="test-name">${test.name}</div>
                <div class="test-dates">
                  <div>
                    <div class="date-label">Hijri:</div>
                    <div class="date-value">${test.hijri.year}-${String(test.hijri.month).padStart(2, '0')}-${String(test.hijri.day).padStart(2, '0')}</div>
                  </div>
                  <div>
                    <div class="date-label">Expected Masehi:</div>
                    <div class="date-value">${test.gregorian.year}-${String(test.gregorian.month).padStart(2, '0')}-${String(test.gregorian.day).padStart(2, '0')}</div>
                  </div>
                  <div>
                    <div class="date-label">Actual Masehi:</div>
                    <div class="date-value">${result.year}-${String(result.month).padStart(2, '0')}-${String(result.day).padStart(2, '0')}</div>
                  </div>
                </div>
              </div>
              <div class="test-result ${isPass ? 'pass' : 'fail'}">
                ${isPass ? '‚úÖ PASS' : '‚ùå FAIL'}
              </div>
            </div>
          `;
        } catch (error) {
          failed++;
          html += `
            <div class="test-row">
              <div class="test-info">
                <div class="test-name">${test.name}</div>
                <div class="test-dates">
                  <div>
                    <div class="date-label">Hijri:</div>
                    <div class="date-value">${test.hijri.year}-${String(test.hijri.month).padStart(2, '0')}-${String(test.hijri.day).padStart(2, '0')}</div>
                  </div>
                  <div>
                    <div class="date-label">Expected Masehi:</div>
                    <div class="date-value">${test.gregorian.year}-${String(test.gregorian.month).padStart(2, '0')}-${String(test.gregorian.day).padStart(2, '0')}</div>
                  </div>
                </div>
              </div>
              <div class="test-result error">
                ‚ùå ERROR
              </div>
            </div>
          `;
        }
      }

      document.getElementById('test-rows').innerHTML = html;
      document.getElementById('total').textContent = expectedResults.length;
      document.getElementById('passed').textContent = passed;
      document.getElementById('failed').textContent = failed;

      loading.style.display = 'none';
      results.style.display = 'block';
      button.disabled = false;
    }

    // Check if Tauri is available
    if (typeof window.__TAURI__ === 'undefined') {
      document.getElementById('loading').innerHTML = '<p style="color: red;">‚ùå Error: Tauri API tidak tersedia. Jalankan file ini dalam aplikasi Tauri.</p>';
      document.getElementById('run-test').style.display = 'none';
    } else {
      document.getElementById('loading').style.display = 'none';
    }
  </script>
</body>
</html>
